---
import Button from "@components/ui/Button.astro";
import Input from "@components/ui/form/Input.astro";
import Textarea from "@components/ui/form/Textarea.astro";
import Radio from "@components/ui/form/Radio.astro";
import Checkbox from "@components/ui/form/Checkbox.astro";

const hearAboutOptions = [
    { label: "Presupuesto", value: "Presupuesto" },
    { label: "Administración", value: "Administración" },
    { label: "Contabilidad", value: "Contabilidad" },
    { label: "Seguros", value: "Seguros" }
];

const interestOptions = [
    { label: "Documentos", value: "documents" },
    { label: "Certificados", value: "certificates" },
    { label: "Gestión de Accesos", value: "access" },
    { label: "Otros", value: "others" }
];

const formBackground = 'light';
---

<!-- <form id="contact-form" class="space-y-6 bg-white p-6 rounded-lg">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Input
            label="Nombre"
            id="name"
            name="name"
            required
            background={formBackground}
        />
        <Input
            label="Email"
            type="email"
            id="email"
            name="email"
            required
            background={formBackground}
        />
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Input
            label="Teléfono"
            type="tel"
            id="phone"
            name="phone"
            background={formBackground}
        />
        <Input
            label="Empresa"
            id="company"
            name="company"
            background={formBackground}
        />
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Radio
            label="¿Por qué motivo quieres contactar con nosotros?"
            id="hear-about"
            name="hear-about"
            options={hearAboutOptions}
            required
            background={formBackground}
        />
        <Checkbox
            label="Solicitud de Documentación"
            id="interests"
            name="interests"
            options={interestOptions}
            background={formBackground}
        />
    </div>

    <Textarea
        label="Mensaje"
        id="message"
        name="message"
        required
        background={formBackground}
    />

    <Checkbox
        label="Acepto los términos y condiciones"
        id="terms"
        name="terms"
        required
        background={formBackground}
    />

    <div class="mt-6">
        <Button type="submit">Enviar</Button>
    </div>
</form>

<p id="status-message" class="mt-4 text-xl"></p> -->
<div
    id="n8n-chat"
    class="h-[600px] space-y-6 bg-white p-6 rounded-lg">
</div>
<script>
    import '@n8n/chat/style.css';
    import { createChat } from '@n8n/chat';

    // Bloquear TODOS los métodos de scroll antes de cargar el chat
    window.scrollTo = function() { return; };
    window.scroll = function() { return; };
    window.scrollBy = function() { return; };
    Element.prototype.scrollTo = function() { return; };
    Element.prototype.scroll = function() { return; };
    Element.prototype.scrollBy = function() { return; };
    Element.prototype.scrollIntoView = function() { return; };

    document.addEventListener('DOMContentLoaded', function() {
        createChat({
            webhookUrl: 'https://jmfortiz.jasodev.es/webhook/b50c3709-d2a6-4e0f-8bb9-72ba69e56438/chat',
            target: '#n8n-chat',
            initialMessages: ['JMF Ortiz a tu servicio.'],
            mode: 'fullscreen',
            i18n: {
                //@ts-ignore
                en: {
                    title: '',
                    subtitle: "Cuentame, Yo enviaré tu consulta al equipo adecuado.",
                    footer: '',
                    getStarted: 'New Conversation',
                    inputPlaceholder: 'Escribe tu consulta..',
                },
            },
        });
    });

    // Solo permitir scroll con rueda del ratón
    let allowScroll = false;
    window.addEventListener('wheel', () => { allowScroll = true; });
    window.addEventListener('touchmove', () => { allowScroll = true; });

    // Interceptar scroll y solo permitirlo si el usuario lo inició
    window.addEventListener('scroll', () => {
        if (!allowScroll && window.pageYOffset !== 0) {
            window.scrollTo(0, 0);
        }
        allowScroll = false;
    });
</script>

<script>
    // const form = document.getElementById('contact-form') as HTMLFormElement;
    // const statusMessage = document.getElementById('status-message') as HTMLParagraphElement;

    // form.addEventListener('submit', async (e) => {
    //     e.preventDefault();
    //     statusMessage.textContent = '';
    //     statusMessage.style.color = 'red';

    //     const formData = new FormData(form);

    //     // Validación básica
    //     const name = formData.get('name')?.trim();
    //     const email = formData.get('email')?.trim();
    //     const termsAccepted = formData.get('terms');

    //     if (!name) {
    //         statusMessage.textContent = 'Por favor, ingresa tu nombre.';
    //         return;
    //     }
    //     if (!email) {
    //         statusMessage.textContent = 'Por favor, ingresa tu correo electrónico.';
    //         return;
    //     }
    //     if (!termsAccepted) {
    //         statusMessage.textContent = 'Debes aceptar los términos y condiciones.';
    //         return;
    //     }

    //     statusMessage.textContent = 'Enviando...';
    //     statusMessage.style.color = 'black';

    //     // Convertir a objeto, gestionando radios y checkboxes
    //     const data = {};
    //     for (const [key, value] of formData.entries()) {
    //         if (data[key]) {
    //             if (!Array.isArray(data[key])) {
    //                 data[key] = [data[key]];
    //             }
    //             data[key].push(value);
    //         } else {
    //             data[key] = value;
    //         }
    //     }

    //     try {
    //         const response = await fetch('https://jmf-email.vercel.app/api/index.js', {
    //             method: 'POST',
    //             headers: { 'Content-Type': 'application/json' },
    //             body: JSON.stringify({
    //                 nombre: data.name,
    //                 email: data.email,
    //                 telefono: data.phone,
    //                 empresa: data.company || '',
    //                 motivo: data['hear-about'] || '',
    //                 intereses: data.interests ? (Array.isArray(data.interests) ? data.interests.join(', ') : data.interests) : '',
    //                 descripcion: data.message,
    //             }),
    //         });

    //         const result = await response.json();

    //         if (!response.ok) {
    //             throw new Error(result.error || 'Error al enviar el mensaje');
    //         }

    //         statusMessage.textContent = '¡Mensaje enviado con éxito!';
    //         statusMessage.style.color = 'green';
    //         form.reset();
    //     } catch (error) {
    //         statusMessage.textContent = error.message;
    //         statusMessage.style.color = 'red';
    //     }
    // });
</script>

